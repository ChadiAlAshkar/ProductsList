<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="../../../../scripts/buildfire.js"></script>

    <script src="../../widget/common/models/Product.js"></script>
    <script src="../../widget/common/models/Introduction.js"></script>
    <script src="../../widget/common/models/Language.js"></script>

    <script src="../../widget/common/controllers/product.js"></script>
    <script src="../../widget/common/controllers/language.js"></script>
    <script src="../../widget/common/controllers/introduction.js"></script>

    <script src="../../widget/common/config/helper.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/mocha/mocha.css" />
  </head>

  <body>
    <div id="mocha"></div>
    <script src="https://unpkg.com/chai/chai.js"></script>
    <script src="https://unpkg.com/mocha/mocha.js"></script>
    <script>
      mocha.setup("bdd");
      //mocha.checkLeaks();

      let expect = chai.expect;

      describe("Models", function () {
        describe("Products", function () {
          it("expect Product to be an object", function () {
            expect(Product).to.be.an("function");
          });
          var p = new Product();
          it("expect Product Have a title", function () {
            expect(p).to.have.property("title");
          });
          it("expect Product Have a profileImgUrl", function () {
            expect(p).to.have.property("profileImgUrl");
          });
          it("expect Product Have a coverImgUrl", function () {
            expect(p).to.have.property("coverImgUrl");
          });
        });
        describe("Introduction", function () {
          it("expect IntroductionItem to be an object", function () {
            expect(IntroductionItem).to.be.an("function");
          });
          var i = new IntroductionItem();
          it("expect IntroductionItem Have a description", function () {
            expect(i).to.have.property("description");
          });
          it("expect Product Have images", function () {
            expect(i).to.have.property("images");
          });
        });
        describe("Language", function () {
          it("expect LanguageItem to be an object", function () {
            expect(LanguageItem).to.be.an("function");
          });
          var l = new LanguageItem();
          it("expect LanguageItem Have a search", function () {
            expect(l).to.have.property("search");
          });
          it("expect Product Have a sortAsc", function () {
            expect(l).to.have.property("sortAsc");
          });
          it("expect Product Have a sortDesc", function () {
            expect(l).to.have.property("sortDesc");
          });
        });
      });

      describe("Content", function () {
        describe("ProductDetails", function () {
          describe("#insert()", function () {
            var product = new Product();
            product.title = "Testdasdsa";
            product.description = "Test dsadad";
            product.profileImgUrl = "http://lorempixel.com/400/200/";
            product.coverImgUrl = "http://lorempixel.com/400/200/";
            product.subTitle = "Test Subtitle";

            it("should add new product", (done) => {
              Products.insert(product)
                .then((product) => {
                  done();
                })
                .catch((err) => {
                  done(err);
                });
            });
          });

          describe("#update()", function () {
            it("should update product", (done) => {
              var searchOptions = {
                filter: {},
                sort: {},
                skip: 0,
                limit: 1,
              };
              Products.search(searchOptions)
                .then((products) => {
                  if (products.length >= 0) {
                    products[0].title = "Updated";
                    products[0].description = "UpdatedDesc";
                    products[0].profileImgUrl =
                      "http://UpdatedDesc.com/400/200/";
                    products[0].coverImgUrl = "http://UpdatedDesc.com/400/200/";
                    products[0].subTitle = "UpdatedTitle";
                    Products.update(products[0].id, products[0])
                      .then((result) => {
                        done();
                      })
                      .catch((err) => {
                        done(err);
                      });
                  } else {
                    done("There are no products to delete!");
                  }
                })
                .catch((err) => {
                  done(err);
                });
            });
          });
        });

        describe("ProductsList", function () {
          describe("#delete()", function () {
            it("should delete product", (done) => {
              var searchOptions = {
                filter: {},
                sort: {},
                skip: 0,
                limit: 1,
              };
              Products.search(searchOptions)
                .then((products) => {
                  if (products.length >= 0) {
                    Products.delete(products[0].id)
                      .then((result) => {
                        done();
                      })
                      .catch((err) => {
                        done(err);
                      });
                  } else {
                    done("There are no products to delete!");
                  }
                })
                .catch((err) => {
                  done(err);
                });
            });
          });

          describe("#getProdByID()", function () {
            it("should Get product by ID", (done) => {
              var searchOptions = {
                filter: {},
                sort: {},
                skip: 0,
                limit: 1,
              };
              Products.search(searchOptions)
                .then((products) => {
                  if (products.length >= 0) {
                    Products.getById(products[0].id)
                      .then((result) => {
                        done();
                      })
                      .catch((err) => {
                        done(err);
                      });
                  } else {
                    done("There are no products to Get!");
                  }
                })
                .catch((err) => {
                  done(err);
                });
            });
          });
        });
      });

      describe("Introduction", function () {
        describe("#Save", function () {
          var introduction = new IntroductionItem();
          introduction.description = "";
          introduction.images = [
            {
              id: 1,
              url: "http://UpdatedDesc.com/400/200/",
            },
            {
              id: 2,
              url: "http://UpdatedDesc.com/400/200/",
            },
          ];
          it("Should save introduction", (done) => {
            Introduction.save(introduction)
              .then((result) => {
                done();
              })
              .catch((err2) => {
                done(err2);
              });
          });
        });

        describe("#Get", function () {
          it("Should get introductions", (done) => {
            Introduction.get()
              .then((result) => {
                done();
              })
              .catch((err) => {
                done(err);
              });
          });
        });
      });

      describe("Language", function () {
        describe("#Save", function () {
          var language = new LanguageItem();
          language.search = "Search";
          language.sortAsc = "Sort A-Z";
          language.sortDesc = "Sort Z-A";

          it("Should save language", (done) => {
            Language.save(language)
              .then((result) => {
                done();
              })
              .catch((err) => {
                done(err);
              });
          });
        });

        describe("#Get", function () {
          it("Should get language", (done) => {
            Language.get()
              .then((result) => {
                done();
              })
              .catch((err) => {
                done(err);
              });
          });
        });
      });

      describe("Widget", function () {
        describe("ProductsList", function () {
          describe("#search()", function () {
            it("should get all products", (done) => {
              var searchOptions = {
                filter: {},
                sort: {},
                skip: 0,
              };
              Products.search(searchOptions)
                .then((products) => {
                  done();
                })
                .catch((err) => {
                  done(err);
                });
            });
          });

          describe("#searchWithFilter()", function () {
            it("should get all products with title 'Item 2'", (done) => {
              var searchOptions = {
                filter: {
                  $or: [
                    { "$json.title": "Item 2" },
                    { "$json.subTitle": "Item 2" },
                  ],
                },
                sort: {},
                skip: 0,
              };
              Products.search(searchOptions)
                .then((products) => {
                  done();
                })
                .catch((err) => {
                  done(err);
                });
            });
          });

          describe("#searchWithLargeFilter()", function () {
            it("should get all products with this filter", (done) => {
              var searchOptions = {
                filter: {
                  $or: [
                    {
                      "$json.title":
                        "Item 2Item 2Item 2Item 2Item 2Item 2Item 2",
                    },
                    {
                      "$json.subTitle":
                        "Item 2Item 2Item 2Item 2Item 2Item 2Item 2",
                    },
                  ],
                },
                sort: {},
                skip: 0,
              };
              Products.search(searchOptions)
                .then((products) => {
                  done();
                })
                .catch((err) => {
                  done(err);
                });
            });
          });

          describe("#searchWithSortTitle()", function () {
            it("should get all products with Titles sorted Desc", (done) => {
              var searchOptions = {
                filter: {},
                sort: {
                  title: -1,
                },
                skip: 0,
              };
              Products.search(searchOptions)
                .then((products) => {
                  done();
                })
                .catch((err) => {
                  done(err);
                });
            });
          });

          describe("#searchWithSortSubTitle()", function () {
            it("should get all products with SubTitles sorted Asc", (done) => {
              var searchOptions = {
                filter: {},
                sort: {
                  subTitle: 1,
                },
                skip: 0,
              };
              Products.search(searchOptions)
                .then((products) => {
                  done();
                })
                .catch((err) => {
                  done(err);
                });
            });
          });
        });
      });
      mocha.run();
    </script>
  </body>
</html>
